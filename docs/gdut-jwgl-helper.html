<!DOCTYPE html>

<html>
<head>
  <title>gdut-jwgl-helper.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>gdut-jwgl-helper.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="-">页面地址路由</h2>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> page = <span class="hljs-keyword">new</span> Page;

 <span class="hljs-comment">// 挂载预先运行回调</span>
 page.before(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Allo!'</span>);
 });

 <span class="hljs-comment">// 挂载对应页面的回调</span>
 page.on(<span class="hljs-string">'/a/page/that/i/will/edit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'in page: a-page-that-i-will-edit'</span>);
 });

 <span class="hljs-comment">// 通过正则来进行匹配</span>
 page.on(<span class="hljs-regexp">/regex\/([\w]+)/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(matched)</span> </span>{
     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'in page: '</span> + matched);
 });

 <span class="hljs-comment">// 如果当前页面地址为: http://example.com/a/page/that/i/will/edit</span>
 <span class="hljs-comment">// 显示: `in page: a-page-that-i-will-edit`;</span>
 <span class="hljs-comment">// 如果当前页面地址为: http://example.com/regex/hello-world</span>
 <span class="hljs-comment">// 显示: `in page: hello-world`。</span>
 page.run();
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Page</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>预先运行的回调函数组</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._beforeRoutes = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>回调函数组</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._routes = {};
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>注册一个预先运行的回调函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Page.prototype.before = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(callback)</span> </span>{
    <span class="hljs-keyword">this</span>._beforeRoutes.push(callback);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>注册一个回调函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Page.prototype.on = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(pattern, callback)</span> </span>{
    <span class="hljs-keyword">var</span> compiledPattern;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._routes[pattern] === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">if</span> (pattern <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
            compiledPattern = pattern;
        } <span class="hljs-keyword">else</span> {
            compiledPattern = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'^'</span> + pattern + <span class="hljs-string">'$'</span>);
        }

        <span class="hljs-keyword">this</span>._routes[pattern] = {
            compiled: compiledPattern,
            callbacks: []
        };
    }

    <span class="hljs-keyword">this</span>._routes[pattern].callbacks.push(callback);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>进行匹配、运行对应回调函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Page.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(url)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>默认使用不带最开始 back slash 的 <code>location.pathname</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (url === <span class="hljs-literal">undefined</span>) {
        url = location.pathname.slice(<span class="hljs-number">1</span>, location.pathname.length);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>执行预先运行的回调函数组</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>._beforeRoutes.length; i++) {
        <span class="hljs-keyword">this</span>._beforeRoutes[i]();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>检查是否有满足条件的回调函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> matchedParts,
        foundMatched = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> pattern <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>._routes) {
        matchedParts = <span class="hljs-keyword">this</span>._routes[pattern].compiled.exec(url);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>找到匹配的，执行已注册的回调函数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (matchedParts !== <span class="hljs-literal">null</span>) {
            foundMatched = <span class="hljs-literal">true</span>;
            
            matchedParts.shift();

            <span class="hljs-keyword">this</span>._routes[pattern].callbacks.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(callback)</span> </span>{
                callback.apply(matchedParts);
            });
        }
    }

    <span class="hljs-keyword">return</span> foundMatched;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="gpa-">GPA 计算器</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> GPA = {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>等级对应成绩</p>
<ul>
<li>免修、优秀： 95</li>
<li>良好：85</li>
<li>中等：75</li>
<li>及格：65</li>
<li>不及格： 0</li>
<li>重修：0</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    realScore: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(score)</span> </span>{
        <span class="hljs-keyword">if</span> (score === <span class="hljs-string">'免修'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">95</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score === <span class="hljs-string">'优秀'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">95</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score === <span class="hljs-string">'良好'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">85</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score === <span class="hljs-string">'中等'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">75</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score === <span class="hljs-string">'及格'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">65</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score === <span class="hljs-string">'不及格'</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>没有填写的情况当作 0 （出现在重修栏）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score === <span class="hljs-string">''</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(score);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>从分数或等级计算绩点</p>
<p>绩点计算公式：</p>
<pre><code> GPA = (s - <span class="hljs-number">50</span>) / <span class="hljs-number">10</span>         (s &gt;= <span class="hljs-number">60</span>)
       <span class="hljs-number">0</span>                     (s &lt; <span class="hljs-number">60</span>)
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    fromScoreOrGradeLevel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(score)</span> </span>{
        score = GPA.realScore(score);

        <span class="hljs-keyword">return</span> (score &lt; <span class="hljs-number">60</span>) ? <span class="hljs-number">0</span> : ((score - <span class="hljs-number">50</span>) / <span class="hljs-number">10</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>计算一门课程的学分绩点</p>
<p>计算公式：</p>
<pre><code> CreditGPA = Credit * GPA      
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    creditGPA: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lecture)</span> </span>{ <span class="hljs-keyword">return</span> lecture.credit * lecture.gpa },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>计算若干门课程的总绩点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sumCredit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lectures)</span> </span>{
        <span class="hljs-keyword">return</span> lectures.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sum, lecture)</span> </span>{
            <span class="hljs-keyword">return</span> sum + lecture.credit;
        }, <span class="hljs-number">0</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>计算若干门课程的平均分</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    avgScore: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lectures)</span> </span>{
        <span class="hljs-keyword">if</span> (lectures.length === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">return</span> lectures.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sum, lecture)</span> </span>{
            <span class="hljs-keyword">return</span> sum + GPA.realScore(lecture.grade.score);
        }, <span class="hljs-number">0</span>) / lectures.length;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>计算若干门课程的平均学分绩点</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    avgCreditGPA: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lectures)</span> </span>{
        <span class="hljs-keyword">if</span> (lectures.length === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">var</span> sumCreditGPA = lectures.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sum, lecture)</span> </span>{
            <span class="hljs-keyword">return</span> sum + GPA.creditGPA(lecture);
        }, <span class="hljs-number">0</span>);

        <span class="hljs-keyword">return</span> sumCreditGPA / GPA.sumCredit(lectures);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>计算若干门课程的加权平均分</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    avgWeightedScore: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lectures)</span> </span>{
        <span class="hljs-keyword">if</span> (lectures.length === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">var</span> sumWeighedScore = lectures.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sum, lecture)</span> </span>{
            <span class="hljs-keyword">return</span> sum + lecture.credit * GPA.realScore(lecture.grade.score);
        }, <span class="hljs-number">0</span>);

        <span class="hljs-keyword">return</span> sumWeighedScore / GPA.sumCredit(lectures);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h2 id="-">课程成绩记录定义</h2>
<ul>
<li>code        :  课程代码</li>
<li>name        :  课程名称</li>
<li>type        :  课程性质（公共基础？专业基础？）</li>
<li>attribution :  课程归属（人文社科？工程基础？）</li>
<li>is_minor    :  是否是辅修专业课？</li>
<li>grade:<ul>
<li>score    :  课程成绩</li>
<li>makeup   :  补考成绩</li>
<li>rework   :  重修成绩</li>
</ul>
</li>
<li>credit      :  学分</li>
<li>gpa         :  绩点</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Lecture</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.code = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.name = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.type = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.attribution = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.isMinor = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.credit = <span class="hljs-number">0.0</span>;
    <span class="hljs-keyword">this</span>.grade = {
        score: <span class="hljs-number">0.0</span>,
        makeup: <span class="hljs-number">0.0</span>,
        rework: <span class="hljs-number">0.0</span>
    };
    <span class="hljs-keyword">this</span>.gpa = <span class="hljs-number">0.0</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>从 <code>table tr</code> 中获取一个课程信息</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Lecture.fromTableRow = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(row)</span> </span>{
    <span class="hljs-keyword">var</span> _t, _f, _p;

    <span class="hljs-keyword">var</span> _parseText = _t = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x)</span> </span>{ <span class="hljs-keyword">return</span> $(x).text().trim() ;},
        _parseFloatOrText = _f = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x)</span> </span>{
            <span class="hljs-keyword">var</span> parsedText = _parseText(x),
                parsedFloat = <span class="hljs-built_in">parseFloat</span>(parsedText);
            
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">isNaN</span>(parsedFloat) ? parsedText : parsedFloat;
        };

    <span class="hljs-keyword">var</span> $cols = $(<span class="hljs-string">'td'</span>, row),
        lecture = <span class="hljs-keyword">new</span> Lecture,
        _takeFromRows = _p = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(idx, parser)</span> </span>{ <span class="hljs-keyword">return</span> parser($cols[idx]); }

    lecture.code = _p(<span class="hljs-number">0</span>, _t);
    lecture.name = _p(<span class="hljs-number">1</span>, _t);
    lecture.type = _p(<span class="hljs-number">2</span>, _t);
    lecture.grade.score = _p(<span class="hljs-number">3</span>, _f) || <span class="hljs-number">0.0</span>;
    lecture.attribution = _p(<span class="hljs-number">4</span>, _t);
    lecture.grade.makeup = _p(<span class="hljs-number">5</span>, _f) || <span class="hljs-number">0.0</span>;
    lecture.grade.rework = _p(<span class="hljs-number">6</span>, _f) || <span class="hljs-number">0.0</span>;
    lecture.credit = _p(<span class="hljs-number">7</span>, _f);
    lecture.isMinor = _p(<span class="hljs-number">8</span>, _t) === <span class="hljs-string">'1'</span>;
    lecture.gpa = GPA.fromScoreOrGradeLevel(lecture.grade.score);

    <span class="hljs-keyword">return</span> lecture;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>从 <code>table</code> 中获取一系列课程信息</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Lecture.fromRows = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(rows)</span> </span>{
    <span class="hljs-keyword">return</span> $.map(rows, Lecture.fromTableRow);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h2 id="-">评价生成器</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> RatingMaker = {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>创建一个包含 n 个<strong>不全部</strong>相同元素的序列
取值范围为： [lo, hi) 间的整数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    makeSequenceBetween: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n, lo, hi)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>确保生成序列中的元素不全部相同</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> [];
        <span class="hljs-keyword">if</span> (lo &gt;= hi - <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> [];

        <span class="hljs-keyword">var</span> length = hi - lo,
            seq = [],
            x;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>生成一个在 [lo, hi - 1] 范围内的整数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            x = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * length) + lo;
            seq.push(x);
        }

        <span class="hljs-keyword">return</span> seq;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="-">助手部分</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> page = <span class="hljs-keyword">new</span> Page;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h3 id="-object-moved-">检查是否为 <code>Object moved</code> 页</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>page.before(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> isObjectMoved = $(<span class="hljs-string">'body h2'</span>).text().search(<span class="hljs-string">'Object moved'</span>) !== -<span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>重定向到首页登录页</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isObjectMoved) {
        location.href = <span class="hljs-string">'http://'</span> + location.host;
    }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="-">登录页</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>page.on(<span class="hljs-string">'default2.aspx'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{});</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h3 id="-">成绩页面</h3>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>计算 GPA</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>page.on(<span class="hljs-string">'xscj.aspx'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>页面元素</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> $infoRows = $(<span class="hljs-string">'#Table1 tbody'</span>),
        $scoreTable = $(<span class="hljs-string">'#DataGrid1'</span>),
        $scoreTableHead = $(<span class="hljs-string">'#DataGrid1 .datelisthead'</span>),
        $scoreRows = $(<span class="hljs-string">'#DataGrid1 tr'</span>).not(<span class="hljs-string">'.datelisthead'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>课程信息</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> lectures = Lecture.fromRows($scoreRows);</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>插入汇总栏: 平均绩点、平均分、加权平均分</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> $avgCell = $(<span class="hljs-string">'&lt;tr&gt;&lt;/tr&gt;'</span>).appendTo($infoRows),
        $avgGPA = $(<span class="hljs-string">'&lt;td class="avg-gpa"&gt;&lt;/td&gt;'</span>).appendTo($avgCell),
        $avgScore = $(<span class="hljs-string">'&lt;td class="avg-score"&gt;&lt;/td&gt;'</span>).appendTo($avgCell),
        $weightedAvgScore = $(<span class="hljs-string">'&lt;td class="weighted-avg-score"&gt;&lt;/td&gt;'</span>).appendTo($avgCell);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>插入各行汇总栏: 绩点、学分绩点、是否加入计算</p>

            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>表头</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'&lt;td&gt;绩点&lt;/td&gt;'</span>).appendTo($scoreTableHead);
    $(<span class="hljs-string">'&lt;td&gt;学分绩点&lt;/td&gt;'</span>).appendTo($scoreTableHead);
    $(<span class="hljs-string">'&lt;td&gt;全选 &lt;input type="checkbox" class="lecture-check-all" /&gt;&lt;/td&gt;'</span>).appendTo($scoreTableHead);</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>各行</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> rowCellsTmpl = [
        <span class="hljs-string">'&lt;td class="gpa"&gt;&lt;/td&gt;'</span>,
        <span class="hljs-string">'&lt;td class="credit-gpa"&gt;&lt;/td&gt;'</span>,
        <span class="hljs-string">'&lt;td &gt;&lt;input type="checkbox" class="lecture-check"&gt;&lt;/input&gt;&lt;/td&gt;'</span>
    ];
    $(rowCellsTmpl.join(<span class="hljs-string">''</span>)).appendTo($scoreRows);

    $scoreRows.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i, row)</span> </span>{
        <span class="hljs-keyword">var</span> $row = $(row),
            lecture = lectures[i];

        $row.find(<span class="hljs-string">'.gpa'</span>).text(lecture.gpa.toFixed(<span class="hljs-number">2</span>));
        $row.find(<span class="hljs-string">'.credit-gpa'</span>).text(GPA.creditGPA(lecture).toFixed(<span class="hljs-number">2</span>));
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>重新计算汇总成绩</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> renderSummarize = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(lectures)</span> </span>{
        <span class="hljs-keyword">var</span> checkedRows = $(<span class="hljs-string">'.lecture-check:checked'</span>).parent().parent(),
            l = Lecture.fromRows(checkedRows);

        $avgGPA.text(<span class="hljs-string">'平均绩点: '</span> + GPA.avgCreditGPA(l).toFixed(<span class="hljs-number">2</span>));
        $avgScore.text(<span class="hljs-string">'平均分: '</span> + GPA.avgScore(l).toFixed(<span class="hljs-number">2</span>));
        $weightedAvgScore.text(<span class="hljs-string">'加权平均分: '</span> + GPA.avgWeightedScore(l).toFixed(<span class="hljs-number">2</span>));
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>绑定各栏的勾选事件</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $scoreRows.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">var</span> $checkbox = $(<span class="hljs-keyword">this</span>).find(<span class="hljs-string">'input'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>反转勾选状态</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $checkbox.prop(<span class="hljs-string">'checked'</span>, !$checkbox.prop(<span class="hljs-string">'checked'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>触发重新计算汇总栏</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        renderSummarize();
    });

    $(<span class="hljs-string">'.lecture-check-all'</span>).change(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>同步勾选状态</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'.lecture-check'</span>).prop(<span class="hljs-string">'checked'</span>, $(<span class="hljs-string">'.lecture-check-all'</span>).is(<span class="hljs-string">':checked'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>触发重新计算汇总栏</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        renderSummarize();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>手动标记为全选</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'.lecture-check-all'</span>).prop(<span class="hljs-string">'checked'</span>, <span class="hljs-literal">true</span>).trigger(<span class="hljs-string">'change'</span>);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>记录成绩情况</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>page.on(<span class="hljs-string">'xscj.aspx'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
});</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h3 id="-">评价页面</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>page.on(<span class="hljs-string">'xsjpj.aspx'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> $btnsGroup = $($(<span class="hljs-string">'td'</span>)[<span class="hljs-number">1</span>]),
        $selections = $(<span class="hljs-string">'select'</span>),
        $btnSave = $(<span class="hljs-string">'#Button1'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>创建一个评价按钮</p>
<p>其中：</p>
<ul>
<li>text: 按钮文字</li>
<li>choiceMake: 选项选择回调函数，接受一个 $selections 选项</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> makeBtn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(text, choiceMaker)</span> </span>{
        <span class="hljs-keyword">var</span> $btn = $(<span class="hljs-string">'&lt;input type="button" /&gt;'</span>);

        $btn.val(text).css(<span class="hljs-string">'margin'</span>, <span class="hljs-string">'5px'</span>);

        $btn.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
            choiceMaker($selections);

            $btnSave.click();
        });

        $btn.appendTo($btnsGroup);

        <span class="hljs-keyword">return</span> $btn;
    };

    makeBtn(<span class="hljs-string">'老师我爱你'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($choices)</span> </span>{
        <span class="hljs-keyword">var</span> seq = RatingMaker.makeSequenceBetween($choices.length, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; seq.length; i++) {
            $choices[i].selectedIndex = seq[i] - <span class="hljs-number">1</span>;
        }
    });

    makeBtn(<span class="hljs-string">'老师我恨你'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($choices)</span> </span>{
        <span class="hljs-keyword">var</span> seq = RatingMaker.makeSequenceBetween($choices.length, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; seq.length; i++) {
            $choices[i].selectedIndex = seq[i] - <span class="hljs-number">1</span>;
        }
    });

    makeBtn(<span class="hljs-string">'老师祝你好运吧！(和谐版)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($choices)</span> </span>{
        <span class="hljs-keyword">var</span> seq = RatingMaker.makeSequenceBetween($choices.length, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; seq.length; i++) {
            $choices[i].selectedIndex = seq[i] - <span class="hljs-number">1</span>;
        }
    });

    makeBtn(<span class="hljs-string">'老师祝你好运吧！(凶残版)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($choices)</span> </span>{
        <span class="hljs-keyword">var</span> seq = RatingMaker.makeSequenceBetween($choices.length, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; seq.length; i++) {
            $choices[i].selectedIndex = seq[i] - <span class="hljs-number">1</span>;
        }
    });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h3 id="-_-_">莫名其妙错误页 <em>(:з」∠)</em></h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>page.on(<span class="hljs-string">'zdy.htm'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    location.href = <span class="hljs-string">'http://'</span> + location.host;
});


page.run();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
